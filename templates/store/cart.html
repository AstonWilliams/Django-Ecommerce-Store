{% extends 'base.html' %}
{% load store_filters %}

{% block title %}Shopping Cart ({{ cart_items.count|default:0 }}) - Walmart Clone{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto bg-white rounded-lg shadow-md p-6">
    <h1 class="text-2xl font-bold text-gray-900 mb-4">
        Shopping Cart ({{ cart_items.count|default:0 }} item{{ cart_items.count|pluralize }})
    </h1>

    {% if user.is_authenticated and cart_items %}
        <div class="flex justify-end mb-4">
            <form action="{% url 'clear_cart' %}" method="post">
                {% csrf_token %}
                <button type="submit" class="text-red-600 hover:text-red-800">Clear cart</button>
            </form>
        </div>

        <div class="space-y-4">
            {% for item in cart_items %}
                <div class="flex items-center border-b py-4">
                    <div class="flex-1">
                        <img src="{{ item.product.image.url|default:'/placeholder.svg' }}" alt="{{ item.product.name }}" class="w-20 h-20 object-cover mr-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">{{ item.product.name }}</h3>
                            <p class="text-gray-600">{{ item.product.description|truncatewords:15 }}</p>
                            <a href="#" class="text-blue-600 hover:underline">Save for later</a>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-semibold text-gray-800">${{ item.product.price|mul:item.quantity|floatformat:2 }}</p>
                        <form action="{% url 'update_cart' item.id %}" method="post" class="flex items-center">
                            {% csrf_token %}
                            <label for="quantity-{{ item.id }}" class="mr-2">Qty:</label>
                            <input type="number" id="quantity-{{ item.id }}" name="quantity" value="{{ item.quantity }}" min="0" class="w-16 p-1 border rounded-md">
                            <button type="submit" name="update" class="ml-2 text-blue-600 hover:text-blue-800">Update</button>
                            <button type="submit" name="remove" class="ml-2 text-red-600 hover:text-red-800">Remove</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
            <div class="text-right text-gray-600">
                {% if subtotal >= 35 %}
                    <p class="text-green-600">Congratulations! You qualify for FREE shipping</p>
                {% else %}
                    <p>Add ${{ 35|sub:subtotal|floatformat:2 }} more to qualify for FREE shipping</p>
                {% endif %}
            </div>
        </div>
    {% else %}
        <div class="text-center">
            <h2 class="text-xl font-semibold text-gray-800">Your cart is empty</h2>
            <p class="text-gray-600">Looks like you haven't added anything to your cart yet. Start shopping to fill it up!</p>
            <a href="{% url 'home' %}" class="inline-block mt-4 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700">Start Shopping</a>
        </div>
    {% endif %}

    {% if user.is_authenticated and cart_items %}
        <div class="mt-6 border-t pt-4">
            <h2 class="text-xl font-semibold text-gray-800">Order Summary</h2>
            <div class="mt-4 space-y-2">
                <div class="flex justify-between">
                    <span>Subtotal ({{ cart_items.count }} item{{ cart_items.count|pluralize }})</span>
                    <span>${{ subtotal|floatformat:2 }}</span>
                </div>
                <div class="flex justify-between">
                    <span>Shipping</span>
                    <span>{% if subtotal >= 35 %}Free{% else %}${{ shipping_cost|floatformat:2 }}{% endif %}</span>
                </div>
                <div class="flex justify-between">
                    <span>Estimated tax</span>
                    <span>${{ tax_amount|floatformat:2 }}</span>
                </div>
                <div class="flex justify-between font-semibold text-lg">
                    <span>Estimated total</span>
                    <span>${{ total|floatformat:2 }}</span>
                </div>
            </div>
            <form action="{% url 'checkout' %}" method="post" class="mt-4">
                {% csrf_token %}
                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition">Proceed to Checkout</button>
            </form>
            <div class="mt-4 text-center">
                <p>We accept:</p>
                <div class="flex justify-center space-x-2">
                    <img src="https://via.placeholder.com/40?text=Visa" alt="Visa">
                    <img src="https://via.placeholder.com/40?text=MasterCard" alt="MasterCard">
                    <img src="https://via.placeholder.com/40?text=PayPal" alt="PayPal">
                </div>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}